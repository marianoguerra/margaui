/* Component: collapse */

/* Base collapse container */
@utility collapse {
  /* Override Tailwind's built-in collapse utility (visibility: collapse) */
  visibility: visible !important;
  /* Ensure text color is set explicitly for shadow DOM compatibility */
  color: var(--color-base-content);
  display: grid;
  position: relative;
  overflow: hidden;
  border-radius: var(--radius-box, 1rem);
  width: 100%;
  grid-template-rows: max-content 0fr;
  grid-template-columns: minmax(0, 1fr);
  isolation: isolate;

  @media (prefers-reduced-motion: no-preference) {
    transition: grid-template-rows 0.2s;
  }

  /* Hidden checkbox/radio for state */
  > input:is([type="checkbox"], [type="radio"]) {
    grid-column-start: 1;
    grid-row-start: 1;
    appearance: none;
    opacity: 0;
  }

  /* Open states */
  &:is([open], [tabindex]:focus:not(.collapse-close), [tabindex]:focus-within:not(.collapse-close)),
  &:not(.collapse-close):has(> input:is([type="checkbox"], [type="radio"]):checked) {
    grid-template-rows: max-content 1fr;
  }

  /* Content visibility when open */
  &:is([open], [tabindex]:focus:not(.collapse-close), [tabindex]:focus-within:not(.collapse-close)) > .collapse-content,
  &:not(.collapse-close) > :where(input:is([type="checkbox"], [type="radio"]):checked ~ .collapse-content) {
    content-visibility: visible;
    min-height: fit-content;
  }

  /* Focus styles */
  &:focus-visible,
  &:has(> input:is([type="checkbox"], [type="radio"]):focus-visible),
  &:has(summary:focus-visible) {
    outline-color: var(--color-base-content);
    outline-style: solid;
    outline-width: 2px;
    outline-offset: 2px;
  }

  /* Cursor for interactive elements */
  &:not(.collapse-close) {
    > input[type="checkbox"],
    > input[type="radio"]:not(:checked),
    > .collapse-title {
      cursor: pointer;
    }
  }

  /* Content padding when open */
  &:is([open], [tabindex]:focus:not(.collapse-close), [tabindex]:focus-within:not(.collapse-close)) > :where(.collapse-content),
  &:not(.collapse-close) > :where(input:is([type="checkbox"], [type="radio"]):checked ~ .collapse-content) {
    padding-bottom: 1rem;
  }
}

/* Collapse title */
@utility collapse-title {
  position: relative;
  display: grid;
  align-items: center;
  min-height: 2.75rem;
  padding: 0.75rem 1rem;
  padding-inline-end: 3rem;
  grid-column-start: 1;
  grid-row-start: 1;
  user-select: none;

  @media (prefers-reduced-motion: no-preference) {
    transition: background-color 0.2s;
  }
}

/* Collapse content */
@utility collapse-content {
  grid-column-start: 1;
  grid-row-start: 2;
  overflow: hidden;
  padding-inline: 1rem;
  min-height: 0;
  content-visibility: hidden;
}

/* Arrow icon variant */
@utility collapse-arrow {
  > .collapse-title:after {
    position: absolute;
    display: block;
    height: 0.5rem;
    width: 0.5rem;
    transform: translateY(-100%) rotate(45deg);
    top: 50%;
    inset-inline-end: 1.4rem;
    content: "";
    transform-origin: 75% 75%;
    box-shadow: 2px 2px;
    pointer-events: none;

    @media (prefers-reduced-motion: no-preference) {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }

  /* Rotate arrow when open */
  &:is([open]) > .collapse-title:after,
  &.collapse-open > .collapse-title:after,
  &[tabindex]:focus:not(.collapse-close) > .collapse-title:after,
  &[tabindex]:focus-within:not(.collapse-close) > .collapse-title:after,
  &:not(.collapse-close) > input:is([type="checkbox"], [type="radio"]):checked ~ .collapse-title:after {
    transform: translateY(-50%) rotate(225deg);
  }
}

/* Plus/minus icon variant */
@utility collapse-plus {
  > .collapse-title:after {
    position: absolute;
    display: block;
    height: 0.5rem;
    width: 0.5rem;
    top: 0.9rem;
    inset-inline-end: 1.4rem;
    content: "+";
    pointer-events: none;

    @media (prefers-reduced-motion: no-preference) {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }

  /* Change to minus when open */
  &:is([open]) > .collapse-title:after,
  &.collapse-open > .collapse-title:after,
  &[tabindex]:focus:not(.collapse-close) > .collapse-title:after,
  &:not(.collapse-close) > input:is([type="checkbox"], [type="radio"]):checked ~ .collapse-title:after {
    content: "âˆ’";
  }
}

/* Force open state */
@utility collapse-open {
  grid-template-rows: max-content 1fr;

  > .collapse-content {
    content-visibility: visible;
    min-height: fit-content;
    padding-bottom: 1rem;
  }
}

/* Force closed state */
@utility collapse-close {
  grid-template-rows: max-content 0fr;

  > .collapse-content {
    content-visibility: hidden;
    min-height: 0;
    padding-bottom: 0;
  }
}
