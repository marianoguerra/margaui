/* Component: toggle */

/* Base toggle */
@utility toggle {
  border: var(--border) solid currentColor;
  color: var(--input-color);
  position: relative;
  display: inline-grid;
  flex-shrink: 0;
  cursor: pointer;
  appearance: none;
  place-content: center;
  vertical-align: middle;
  user-select: none;
  grid-template-columns: 0fr 1fr 1fr;
  --radius-selector-max: calc(var(--radius-selector) + var(--radius-selector) + var(--radius-selector));
  border-radius: calc(var(--radius-selector) + min(var(--toggle-p), var(--radius-selector-max)) + min(var(--border), var(--radius-selector-max)));
  padding: var(--toggle-p);
  box-shadow: 0 1px color-mix(in oklab, currentColor calc(var(--depth) * 10%), transparent) inset;
  transition: color 0.3s, grid-template-columns 0.2s;
  --input-color: color-mix(in oklab, var(--color-base-content) 50%, transparent);
  --toggle-p: calc(var(--size) * 0.125);
  --size: calc(var(--size-selector, 0.25rem) * 6);
  width: calc((var(--size) * 2) - (var(--border) + var(--toggle-p)) * 2);
  height: var(--size);

  &:before {
    position: relative;
    inset-inline-start: 0;
    grid-column-start: 2;
    grid-row-start: 1;
    aspect-ratio: 1 / 1;
    height: 100%;
    border-radius: var(--radius-selector);
    background-color: currentcolor;
    translate: 0;
    content: "";
    transition: background-color 0.1s, translate 0.2s, inset-inline-start 0.2s;
    box-shadow: 0 -1px oklch(0% 0 0 / calc(var(--depth) * 0.1)) inset, 0 8px 0 -4px oklch(100% 0 0 / calc(var(--depth) * 0.1)) inset, 0 1px color-mix(in oklab, currentColor calc(var(--depth) * 10%), transparent);
    background-size: auto, calc(var(--noise) * 100%);
    background-image: none, var(--fx-noise);

    @media (forced-colors: active) {
      outline-style: solid;
      outline-width: 1px;
      outline-offset: -1px;
    }

    @media print {
      outline: 0.25rem solid;
      outline-offset: -1rem;
    }
  }

  &:focus-visible,
  &:has(:focus-visible) {
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }

  &:checked,
  &[aria-checked="true"],
  &:has(> input:checked) {
    grid-template-columns: 1fr 1fr 0fr;
    --input-color: var(--color-base-content);

    &:before {
      background-color: currentcolor;
    }
  }

  &:indeterminate {
    grid-template-columns: 0.5fr 1fr 0.5fr;
  }

  &:disabled {
    cursor: not-allowed;
    opacity: 30%;

    &:before {
      background-color: transparent;
      border: var(--border) solid currentColor;
    }
  }
}

/* Child elements â€” must stay outside @utility (child selectors) */
.toggle > * {
  z-index: 1;
  grid-column: span 1 / span 1;
  grid-column-start: 2;
  grid-row-start: 1;
  height: 100%;
  cursor: pointer;
  appearance: none;
  background-color: transparent;
  padding: 0.125rem;
  transition: opacity 0.2s, rotate 0.4s;
  border: none;
}

.toggle > *:focus {
  outline-style: none;
}

@media (forced-colors: active) {
  .toggle > *:focus {
    outline: 2px solid transparent;
    outline-offset: 2px;
  }
}

.toggle > *:nth-child(2) {
  color: var(--color-base-100);
  rotate: 0deg;
}

.toggle > *:nth-child(3) {
  color: var(--color-base-100);
  opacity: 0%;
  rotate: -15deg;
}

.toggle:has(:checked) > :nth-child(2) {
  opacity: 0%;
  rotate: 15deg;
}

.toggle:has(:checked) > :nth-child(3) {
  opacity: 100%;
  rotate: 0deg;
}

/* Background in layer so utilities can override */
@layer components {
  .toggle:checked,
  .toggle[aria-checked="true"],
  .toggle:has(> input:checked) {
    background-color: var(--color-base-100);
  }
}

/* Color variants */
@utility toggle-primary {
  --toggle-color: var(--color-primary);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-primary);
  }
}

@utility toggle-secondary {
  --toggle-color: var(--color-secondary);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-secondary);
  }
}

@utility toggle-accent {
  --toggle-color: var(--color-accent);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-accent);
  }
}

@utility toggle-neutral {
  --toggle-color: var(--color-neutral);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-neutral);
  }
}

@utility toggle-info {
  --toggle-color: var(--color-info);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-info);
  }
}

@utility toggle-success {
  --toggle-color: var(--color-success);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-success);
  }
}

@utility toggle-warning {
  --toggle-color: var(--color-warning);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-warning);
  }
}

@utility toggle-error {
  --toggle-color: var(--color-error);

  &:checked,
  &[aria-checked="true"] {
    --input-color: var(--color-error);
  }
}

/* Size variants */
@utility toggle-xs {
  --size: calc(var(--size-selector, 0.25rem) * 4);
}

@utility toggle-sm {
  --size: calc(var(--size-selector, 0.25rem) * 5);
}

@utility toggle-md {
  --size: calc(var(--size-selector, 0.25rem) * 6);
}

@utility toggle-lg {
  --size: calc(var(--size-selector, 0.25rem) * 7);
}

@utility toggle-xl {
  --size: calc(var(--size-selector, 0.25rem) * 8);
}
