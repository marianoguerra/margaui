/* Component: dropdown */

/* Dropdown animation */
@keyframes dropdown {
  from {
    opacity: 0;
    scale: 95%;
  }
  to {
    opacity: 1;
    scale: 100%;
  }
}

/* Base dropdown */
@utility dropdown {
  position: relative;
  display: inline-block;
  position-area: var(--anchor-v, bottom) var(--anchor-h, span-right);

  > *:not(:has(~ [class*="dropdown-content"])):focus {
    outline-style: none;

    @media (forced-colors: active) {
      outline: 2px solid transparent;
      outline-offset: 2px;
    }
  }

  .dropdown-content {
    position: absolute;
  }

  &.dropdown-close .dropdown-content,
  &:not(details, .dropdown-open, .dropdown-hover:hover, :focus-within) .dropdown-content,
  &.dropdown-hover:not(:hover) [tabindex]:first-child:focus:not(:focus-visible) ~ .dropdown-content {
    display: none;
    transform-origin: top;
    opacity: 0%;
    scale: 95%;
  }

  &[popover],
  .dropdown-content {
    z-index: 999;

    @media (prefers-reduced-motion: no-preference) {
      animation: dropdown 0.2s;
      transition-property: opacity, scale, display;
      transition-behavior: allow-discrete;
      transition-duration: 0.2s;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }
  }

  @starting-style {
    &[popover],
    .dropdown-content {
      scale: 95%;
      opacity: 0;
    }
  }

  &:not(.dropdown-close) {
    &.dropdown-open,
    &:not(.dropdown-hover):focus,
    &:focus-within {
      > [tabindex]:first-child {
        pointer-events: none;
      }

      .dropdown-content {
        opacity: 100%;
        scale: 100%;
      }
    }

    &.dropdown-hover:hover {
      .dropdown-content {
        opacity: 100%;
        scale: 100%;
      }
    }
  }

  &:is(details) {
    summary {
      &::-webkit-details-marker {
        display: none;
      }
    }
  }

  &:where([popover]) {
    background: transparent;
  }

  &[popover] {
    position: fixed;
    color: inherit;

    @supports not (position-area: bottom) {
      margin: auto;

      &.dropdown-close,
      &.dropdown-open:not(:popover-open) {
        display: none;
        transform-origin: top;
        opacity: 0%;
        scale: 95%;
      }

      &::backdrop {
        background-color: color-mix(in oklab, #000 30%, transparent);
      }
    }

    &.dropdown-close,
    &:not(.dropdown-open, :popover-open) {
      display: none;
      transform-origin: top;
      opacity: 0%;
      scale: 95%;
    }
  }
}

/* Dropdown content */
@utility dropdown-content {
  position: absolute;
  z-index: 999;
}

/* State modifiers - need at least one property for @utility */
@utility dropdown-open {
  --dropdown-open: 1;
}

@utility dropdown-close {
  --dropdown-close: 1;
}

@utility dropdown-hover {
  --dropdown-hover: 1;
}

/* Position variants */
@utility dropdown-bottom {
  --anchor-v: bottom;

  .dropdown-content {
    top: 100%;
    bottom: auto;
    transform-origin: top;
  }
}

@utility dropdown-top {
  --anchor-v: top;

  .dropdown-content {
    top: auto;
    bottom: 100%;
    transform-origin: bottom;
  }
}

@utility dropdown-right {
  --anchor-h: right;
  --anchor-v: span-bottom;

  .dropdown-content {
    inset-inline-start: 100%;
    top: 0;
    bottom: auto;
    transform-origin: 0;
  }
}

@utility dropdown-left {
  --anchor-h: left;
  --anchor-v: span-bottom;

  .dropdown-content {
    inset-inline-end: 100%;
    top: 0;
    bottom: auto;
    transform-origin: 100%;
  }
}

/* Alignment variants */
@utility dropdown-center {
  --anchor-h: center;

  :where(.dropdown-content) {
    inset-inline-end: calc(1 / 2 * 100%);
    translate: 50% 0;

    [dir="rtl"] & {
      translate: -50% 0;
    }
  }

  &.dropdown-left {
    --anchor-h: left;
    --anchor-v: center;

    .dropdown-content {
      top: auto;
      bottom: calc(1 / 2 * 100%);
      translate: 0 50%;
    }
  }

  &.dropdown-right {
    --anchor-h: right;
    --anchor-v: center;

    .dropdown-content {
      top: auto;
      bottom: calc(1 / 2 * 100%);
      translate: 0 50%;
    }
  }
}

@utility dropdown-end {
  --anchor-h: span-left;

  :where(.dropdown-content) {
    inset-inline-end: 0;
    translate: 0 0;

    [dir="rtl"] & {
      translate: 0 0;
    }
  }

  &.dropdown-left {
    --anchor-h: left;
    --anchor-v: span-top;

    .dropdown-content {
      top: auto;
      bottom: 0;
    }
  }

  &.dropdown-right {
    --anchor-h: right;
    --anchor-v: span-top;

    .dropdown-content {
      top: auto;
      bottom: 0;
    }
  }
}

@utility dropdown-start {
  --anchor-h: span-right;

  :where(.dropdown-content) {
    inset-inline-end: auto;
    translate: 0 0;

    [dir="rtl"] & {
      translate: 0 0;
    }
  }

  &.dropdown-left {
    --anchor-h: left;
    --anchor-v: span-bottom;

    .dropdown-content {
      top: 0;
      bottom: auto;
    }
  }

  &.dropdown-right {
    --anchor-h: right;
    --anchor-v: span-bottom;

    .dropdown-content {
      top: 0;
      bottom: auto;
    }
  }
}
